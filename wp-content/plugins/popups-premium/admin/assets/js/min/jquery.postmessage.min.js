/*
 * jQuery postMessage - v0.5 - 9/11/2009
 * http://benalman.com/projects/jquery-postmessage-plugin/
 *
 * Copyright (c) 2009 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($){var g,d,j=1,a,b=this,f=!1,h="postMessage",e="addEventListener",c,i=b[h]&&!$.browser.opera;$[h]=function(k,l,m){if(!l){return}k=typeof k==="string"?k:$.param(k);m=m||parent;if(i){m[h](k,l.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(l){m.location=l.replace(/#.*$/,"")+"#"+(+new Date)+(j++)+"&"+k}}};$.receiveMessage=c=function(l,m,k){if(i){if(l){a&&c();a=function(n){if((typeof m==="string"&&n.origin!==m)||($.isFunction(m)&&m(n.origin)===f)){return f}l(n)}}if(b[e]){b[l?e:"removeEventListener"]("message",a,f)}else{b[l?"attachEvent":"detachEvent"]("onmessage",a)}}else{g&&clearInterval(g);g=null;if(l){k=typeof m==="number"?m:typeof k==="number"?k:100;g=setInterval(function(){var o=document.location.hash,n=/^#?\d+&/;if(o!==d&&n.test(o)){d=o;l({data:o.replace(n,"")})}},k)}}}})(jQuery);
jQuery.extend({
    getQueryParameters : function(str) {
        return (str || document.location.search).replace(/(^\?)/,'').split("&").map(function(n){return n = n.split("="),this[n[0]] = n[1],this}.bind({}))[0];
    }
});
function ccontact( el ){
    // Set variables for the postMessage request.
    var spu_request_url      = 'https://timersys.com';
    var spu_request_provider = el.data('provider');
    var oauth_window    = window.open( el.attr('href'), '', 'resizable=yes,location=no,width=750,height=600,top=0,left=0' );

    // Listen to the callback and set the fields.
    var spu_request_call = setInterval(function(){
        var message = 'Hello World';
        jQuery.postMessage(message, spu_request_url, oauth_window);
    }, 6000);

    jQuery.receiveMessage(function(e){
        var data = jQuery.getQueryParameters(decodeURIComponent(e.data));
        if( data.event && data.event == 'spu_oauth')
            clearInterval(spu_request_call);
        jQuery('#'+ spu_request_provider + '_api' ).text( data.access_token );
        jQuery('#'+ spu_request_provider + '_connect').click();
    }, false);
}